Pré requis :
	Server dns & san configuré
	Server master fait.
	Répertoire partagées en place.

Installation d'un cluster RAC 2 noeuds avec Oracle Database server 12.1.0.2 sur Oracle Linux 7.2
Note les temps données sont valables sur mon PC, les temps dépendent de la performance des disques du PC.

Se positionner dans le répertoire ~/plescripts/infra
cd ~/plescripts/infra

Création du cluster mickey :
	2 serveurs srvmickey01 et srvmickey02

1)	Création des fichiers de descriptions de l'infra :
	./new_infra.sh -db=mickey -max_nodes=2
	~1s d'exécution

2)	cloner physiquement les machines	~5mn
	Depuis windows exécuter le script mickey_make_clone_from_master.bat

3)	Démarrer, depuis windows, la première vm srvmickey01

	set PATH=%PATH%;"C:\Program Files\Oracle\VirtualBox"
	VBoxManage startvm srvmickey01 --type headless

	script clonage noeud 1				~5mn
	./clone_master.sh -db=mickey -node=1

4)	Démarrer, depuis windows, la seconde vm srvmickey02 

	set PATH=%PATH%;"C:\Program Files\Oracle\VirtualBox"
	VBoxManage startvm srvmickey02 --type headless

	script clonage noeud 2				~5mn
	./clone_master.sh -db=mickey -node=2

5)	Se connecter root sur le noeud srvmickey01
	cd ~/plescripts/ssh
	./ssh_equi_cluster_rac.sh -remote_server=srvmickey02

	Se connecter root sur le noeud srvmickey02
	cd ~/plescripts/ssh
	./ssh_equi_cluster_rac.sh -remote_server=srvmickey01

6)	./install_grid.sh -db=mickey -action=install
		16mn23s	pour l'installation du grid
		 8mn10s	post scripts noeud 1
		 6mn23s	post scripts noeud 2
			35s	pour la création et le montage des DG DATA & FRA
	
		31mn31s au total

7)	./install_oracle.sh -db=mickey -action=install
		32mn52s	pour l'installation des binaires oracle
		     1s	post scripts noeud 1
			 1s	post scripts noeud 2

		32mn54s au total

8)	Création de la base
	Se connecter avec le compre oracle sur un des noeuds
	cd ~/plescripts/db
	./create_db.sh -name=mickey
	Va créer un CDC uniquement.
	Après vous pouvez créer autant de PDB que vous voulez.
	De 30mn à 2h celon l'activité sur les disques :(

Les mêmes scripts sont utilisables pour créer une base de type single.
Il suffit de ne pas préciser le nombre de noeuds au script new_infra.sh
Par exemple :	./new_infra.sh -db=donald permettra de créer une base standalone
				Il y a moins d'action et c'est vraiment plus rapide (Entre 30mn et 45mn maximum)

J'ai pas grand chose à faire pour créer un rac one-node, juste ajouter l'option -one-node au
script new_infra.sh

Pour le moment le RAC et administrateur managed, mais avec juste une option de plus au script
new_infra.sh je pourrais facilement faire un RAC services managed.

Je n'envisage pas pour le moment de faire un RAC Flex car je n'ai pas suffisamment de mémoire sur mon PC :(

====================================================================================================
									Description des scripts.
====================================================================================================
Script : new_infra.sh 
	1)	Création des fichiers décrivant l'infra à mettre en place

	2)	Création des scripts .bat (donc pour windows) dans le répertoire partagé windows / linux
		- un script pour le clonage de la/les vms
		- script pour démarrer la/les vms
		- script pour stopper la/les vms
		- script pour éteindre la/les vms
	
	Ca évite de lancer l'interface graphique de virtualbox.
		

Script : clone_master.sh
	Une seule action utilisateur : saisir le mot de passe root du noeud.

	1)	Enregistre les adresses des serveurs dans le dns

	2)	Création des comptes grid & oracle
		Installation des packages nécessaire.
		Installation d'oracleasm
		Application de pré-requis oracle pour les comptes grid & oracle

	3)	Configuration des 3 interfaces :
			enp0s3	:	par défaut éteinte sert uniquement pour yum
			enp0s8	:	réseau public interne
			enp0s9	:	réseau privé interne pour les intercos RAC & SAN		
		(TODO ajouter une carte pour la redondance des intercos)

	4)	Sur le premier noeud uniquement : 
				Création des disques sur le SAN
				montage du répertoire contenant les binaires d'installation grid & oracle

		Sur tous les noeuds mapping des disques avec oracleasm

	5)	Création des connexions ssh depuis le poster client vers les comptes
		root, grid et oracle (pour ne pas à avoir à saisir les mots de passes)
			
Script : ./ssh_equi_cluster_rac.sh
	Une seule action utilisateur : saisir le mot de passe root du noeud.

	Etablie les connexion ssh et auto équivalence ssh pour root, oracle et le grid.

Script : install_grid.sh
	Aucune action utilisateur requise (sauf lancer le script)

	1) Création du fichier réponse et properties

	2) Lancement de l'installation du grid

	3) Lancement des scripts post install sur tous les noeuds

	4) Sur le premier noeud création des DG data et fra
	   Sur les autres noeud montage des DG data et fra

Script : install_oracle.sh
	Aucune action utilisateur requise (sauf lancer le script)

	1) Création du fichier réponse et properties

	2) Lancement de l'installation d'oracle

	3) Lancement des scripts post install sur tous les noeuds

Script : create_db.sh
	Aucune action utilisateur requise (sauf lancer le script)

	1) Création de la base et enregistrement dans le grid.
